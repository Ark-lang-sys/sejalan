<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Dashboard — Sejalan</title>

  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    body { scroll-behavior: smooth; }
    .fade { animation: fade .5s ease forwards; opacity: 0; }
    @keyframes fade { to { opacity: 1; } }
  </style>
</head>

<body class="bg-gradient-to-b from-pink-100 via-white to-rose-200 min-h-screen">

<!-- HEADER (RINGKAS & MOBILE) -->
<header class="bg-white/90 backdrop-blur border-b sticky top-0 z-50 fade">
  <div class="px-4 py-3 flex items-center justify-between">
    <div class="flex items-center gap-2">
      <div class="w-9 h-9 rounded-full bg-gradient-to-br from-pink-500 to-rose-600
                  text-white flex items-center justify-center font-bold text-sm">
        S
      </div>
      <span class="font-bold text-pink-600 text-base">SEJALAN</span>
    </div>
    <button id="logoutBtn" class="text-xs text-gray-500">
      Logout
    </button>
  </div>
</header>

<main class="px-4 py-6 space-y-8 max-w-xl mx-auto">

<!-- INTRO -->
<section class="fade">
  <h1 class="text-xl font-bold text-gray-900 leading-tight">
    Perjalanan Ta’aruf Anda
  </h1>
  <p class="mt-2 text-sm text-gray-600">
    Ikuti langkah bertahap agar proses berjalan aman, matang, dan bertanggung jawab.
  </p>
</section>

<!-- PROGRESS INDICATOR -->
<section class="fade">
  <div class="bg-white rounded-2xl p-4 shadow">
    <div class="flex justify-between text-xs text-gray-500 mb-2">
      <span>Langkah</span>
      <span id="progressText">1 dari 3</span>
    </div>
    <div class="w-full h-2 bg-gray-200 rounded-full overflow-hidden">
      <div id="progressBar"
           class="h-full bg-pink-500 rounded-full transition-all"
           style="width: 33%">
      </div>
    </div>
  </div>
</section>

<!-- STEP LIST (STACKED) -->
<section class="space-y-4 fade">

  <!-- STEP 1 -->
  <div id="step1"
       class="bg-white rounded-2xl p-5 shadow border border-pink-300">
    <h3 class="font-semibold text-pink-600 text-sm mb-1">
      1️⃣ Lengkapi Profil
    </h3>
    <p class="text-xs text-gray-600 mb-4">
      Data diri, preferensi, & foto sesuai panduan.
    </p>
    <a href="step1-profile.html"
       class="block w-full text-center bg-pink-500 text-white py-3 rounded-xl text-sm font-semibold">
      Lengkapi Profil
    </a>
  </div>

  <!-- STEP 2 -->
  <div id="step2"
       class="bg-white rounded-2xl p-5 shadow opacity-60">
    <h3 class="font-semibold text-gray-700 text-sm mb-1">
      2️⃣ Deep Assessment
    </h3>
    <p class="text-xs text-gray-600 mb-4">
      Refleksi nilai, kesiapan, & tujuan relasi.
    </p>
    <button disabled
      class="block w-full bg-gray-300 text-white py-3 rounded-xl text-sm font-semibold">
      Terkunci
    </button>
  </div>

  <!-- STEP 3 -->
  <div id="step3"
       class="bg-white rounded-2xl p-5 shadow opacity-60">
    <h3 class="font-semibold text-gray-700 text-sm mb-1">
      3️⃣ Top Matches
    </h3>
    <p class="text-xs text-gray-600 mb-4">
      Rekomendasi sejalan berdasarkan asesmen.
    </p>
    <button disabled
      class="block w-full bg-gray-300 text-white py-3 rounded-xl text-sm font-semibold">
      Belum Tersedia
    </button>
  </div>

</section>

<!-- MATCHES PREVIEW CARD -->
<section class="fade">
  <div class="bg-white rounded-2xl p-6 shadow text-center opacity-60">
    <h2 class="text-base font-semibold text-gray-700 mb-2">
      Top Matches Anda
    </h2>
    <p class="text-xs text-gray-500">
      Akan terbuka setelah semua langkah diselesaikan.
    </p>
  </div>
</section>

</main>

<!-- SCRIPT -->
<script type="module">
  import { auth } from "./firebase.js";
  import {
    onAuthStateChanged,
    signOut
  } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
  import {
    getFirestore,
    doc,
    getDoc
  } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

  const db = getFirestore();

  onAuthStateChanged(auth, async (user) => {
    if (!user) {
      window.location.href = "login.html";
      return;
    }

    const snap = await getDoc(doc(db, "users", user.uid));
    if (!snap.exists()) return;

    const data = snap.data();

    let progress = 1;

    // STEP 1 COMPLETE
    if (data.profileCompleted) {
      progress = 2;
      document.getElementById("step2").classList.remove("opacity-60");
      document.getElementById("step2").innerHTML = `
        <h3 class="font-semibold text-pink-600 text-sm mb-1">2️⃣ Deep Assessment</h3>
        <p class="text-xs text-gray-600 mb-4">
          Refleksi kesiapan & nilai relasi.
        </p>
        <a href="step2-deep-assessment.html"
           class="block w-full text-center bg-pink-500 text-white py-3 rounded-xl text-sm font-semibold">
          Mulai Assessment
        </a>
      `;
    }

    // STEP 2 COMPLETE
    if (data.step2Completed) {
      progress = 3;
      document.getElementById("step3").classList.remove("opacity-60");
      document.getElementById("step3").innerHTML = `
        <h3 class="font-semibold text-pink-600 text-sm mb-1">3️⃣ Top Matches</h3>
        <p class="text-xs text-gray-600 mb-4">
          Lihat rekomendasi awal Anda.
        </p>
        <a href="matches.html"
           class="block w-full text-center bg-pink-500 text-white py-3 rounded-xl text-sm font-semibold">
          Lihat Rekomendasi
        </a>
      `;
    }

    document.getElementById("progressText").innerText = progress + " dari 3";
    document.getElementById("progressBar").style.width = (progress / 3 * 100) + "%";
  });

  document.getElementById("logoutBtn").onclick = async () => {
    await signOut(auth);
    window.location.href = "login.html";
  };
</script>

</body>
</html>
