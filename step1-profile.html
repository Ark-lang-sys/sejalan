<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Profil Dasar — Sejalan</title>

  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    .fade { animation: fade .8s ease forwards; opacity: 0; }
    .slide { animation: slide .9s ease forwards; opacity: 0; }
    @keyframes fade { to { opacity: 1; } }
    @keyframes slide {
      from { opacity: 0; transform: translateY(24px); }
      to { opacity: 1; transform: translateY(0); }
    }
  </style>
</head>

<body class="bg-gradient-to-br from-rose-100 via-white to-pink-200 min-h-screen">

<!-- ================= HEADER ================= -->
<header class="bg-white/80 backdrop-blur border-b sticky top-0 z-50 fade">
  <div class="max-w-6xl mx-auto px-6 py-4 flex items-center gap-3">
    <div class="w-10 h-10 rounded-full bg-gradient-to-br from-pink-500 to-rose-600
                text-white flex items-center justify-center font-bold">
      S
    </div>
    <span class="font-bold text-xl text-pink-600">SEJALAN</span>
  </div>
</header>

<!-- ================= MAIN ================= -->
<main class="max-w-3xl mx-auto px-6 py-12">

  <!-- INTRO -->
  <section class="slide">
    <h1 class="text-3xl font-bold text-gray-900">
      Profil Dasar
    </h1>
    <p class="mt-4 text-gray-600 leading-relaxed">
      Informasi ini digunakan sebagai dasar pencocokan awal.
      Data bersifat terbatas, tidak ditampilkan penuh ke publik,
      dan digunakan secara bertanggung jawab.
    </p>
  </section>

  <!-- FORM -->
  <form id="profileForm" class="mt-10 space-y-10">

    <!-- ================= CORE PROFILE ================= -->
    <section class="bg-white p-8 rounded-3xl shadow-xl slide">
      <h2 class="text-lg font-semibold text-pink-600 mb-6">
        Core Profile
      </h2>

      <div class="space-y-4">
        <input id="fullName" type="text" placeholder="Nama Lengkap"
          class="w-full px-4 py-3 border rounded-xl focus:ring-2 focus:ring-pink-400" required />

        <input id="age" type="number" min="18" placeholder="Usia"
          class="w-full px-4 py-3 border rounded-xl focus:ring-2 focus:ring-pink-400" required />

        <input id="city" type="text" placeholder="Domisili (Kota)"
          class="w-full px-4 py-3 border rounded-xl focus:ring-2 focus:ring-pink-400" required />

        <!-- ✅ DROPDOWN PENDIDIKAN -->
        <select id="education"
          class="w-full px-4 py-3 border rounded-xl bg-white focus:ring-2 focus:ring-pink-400"
          required>
          <option value="" disabled selected>Pendidikan Terakhir</option>
          <option value="SMA/SMK/Sederajat">SMA / SMK / Sederajat</option>
          <option value="Diploma">Diploma (D1–D3)</option>
          <option value="Sarjana">Sarjana (S1)</option>
          <option value="Magister">Magister (S2)</option>
          <option value="Doktor">Doktor (S3)</option>
          <option value="Non-formal">Pendidikan non-formal</option>
          <option value="Lainnya">Lainnya</option>
        </select>

        <input id="job" type="text" placeholder="Pekerjaan Saat Ini"
          class="w-full px-4 py-3 border rounded-xl focus:ring-2 focus:ring-pink-400" required />

        <textarea id="lifestyle" rows="2"
          placeholder="Gaya hidup singkat (contoh: aktif, sederhana, religius, dll)"
          class="w-full px-4 py-3 border rounded-xl focus:ring-2 focus:ring-pink-400"
          required></textarea>

        <textarea id="familyContext" rows="2"
          placeholder="Kondisi keluarga secara umum (opsional tapi disarankan)"
          class="w-full px-4 py-3 border rounded-xl focus:ring-2 focus:ring-pink-400"></textarea>
      </div>
    </section>

    <!-- ================= PREFERENCES ================= -->
    <section class="bg-white p-8 rounded-3xl shadow-xl slide">
      <h2 class="text-lg font-semibold text-pink-600 mb-6">
        Preferensi & Batasan
      </h2>

      <div class="space-y-4">
        <div class="grid grid-cols-2 gap-4">
          <input id="prefAgeMin" type="number" placeholder="Usia min"
            class="px-4 py-3 border rounded-xl focus:ring-2 focus:ring-pink-400" required />

          <input id="prefAgeMax" type="number" placeholder="Usia max"
            class="px-4 py-3 border rounded-xl focus:ring-2 focus:ring-pink-400" required />
        </div>

        <input id="prefLocation" type="text"
          placeholder="Preferensi lokasi (kota / fleksibel)"
          class="w-full px-4 py-3 border rounded-xl focus:ring-2 focus:ring-pink-400"
          required />

        <textarea id="values" rows="2"
          placeholder="Nilai penting dalam hubungan (kejujuran, komitmen, dll)"
          class="w-full px-4 py-3 border rounded-xl focus:ring-2 focus:ring-pink-400"
          required></textarea>

        <textarea id="dealbreakers" rows="2"
          placeholder="Hal yang tidak bisa ditoleransi (deal breakers)"
          class="w-full px-4 py-3 border rounded-xl focus:ring-2 focus:ring-pink-400"
          required></textarea>
      </div>
    </section>

    <!-- ================= CONFIRM ================= -->
    <section class="bg-white p-6 rounded-3xl shadow-xl slide">
      <label class="flex items-start gap-3 text-sm text-gray-600">
        <input type="checkbox" required class="mt-1" />
        <span>
          Saya mengisi data dengan jujur dan memahami bahwa
          kelengkapan profil mempengaruhi kualitas rekomendasi.
        </span>
      </label>
    </section>

    <!-- SUBMIT -->
    <div class="pt-4 slide">
      <button type="submit"
        class="w-full bg-gradient-to-r from-pink-500 to-rose-600
               text-white py-4 rounded-full font-semibold hover:opacity-90">
        Simpan & Lanjutkan →
      </button>
    </div>

  </form>

</main>

<!-- ================= SCRIPT ================= -->
<script type="module">
  import { auth } from "./firebase.js";
  import { onAuthStateChanged }
    from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
  import {
    getFirestore,
    doc,
    updateDoc
  } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

  onAuthStateChanged(auth, (user) => {
    if (!user) window.location.href = "login.html";
  });

  const form = document.getElementById("profileForm");

  form.addEventListener("submit", async (e) => {
    e.preventDefault();

    const user = auth.currentUser;
    const db = getFirestore();

    await updateDoc(doc(db, "users", user.uid), {
      profile: {
        fullName: fullName.value,
        age: Number(age.value),
        city: city.value,
        education: education.value,
        job: job.value,
        lifestyle: lifestyle.value,
        familyContext: familyContext.value
      },
      preferences: {
        ageMin: Number(prefAgeMin.value),
        ageMax: Number(prefAgeMax.value),
        location: prefLocation.value,
        values: values.value,
        dealbreakers: dealbreakers.value
      },
      profileCompleted: true,
      step1Completed: true,
      updatedAt: new Date()
    });

    window.location.href = "dashboard.html";
  });
</script>

</body>
</html>
